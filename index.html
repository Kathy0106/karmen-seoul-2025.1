<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>2025 Christmas SEOUL trip ğŸ„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;}
    body{background:#f4f7fb;color:#222;}
    .app{max-width:480px;margin:0 auto 40px;background:#f4f7fb;}
    /* hero */
    .hero{
      position:relative;
      height:220px;
      overflow:hidden;
      border-bottom-left-radius:24px;
      border-bottom-right-radius:24px;
      background:#6db5ff url('cover.jpg') center/cover no-repeat;
      color:#fff;
    }
    .hero::after{
      content:"";
      position:absolute;
      inset:0;
      background:linear-gradient(180deg,rgba(0,0,0,0.55),rgba(0,0,0,0.1));
    }
    .hero-inner{
      position:relative;
      z-index:1;
      padding:18px 16px 12px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      height:100%;
    }
    .hero-title{font-size:20px;font-weight:700;}
    .hero-dates{margin-top:4px;font-size:13px;opacity:.9;}
    .hero-dest{margin-left:auto;text-align:right;font-size:12px;}
    .hero-dest strong{display:block;font-size:18px;}
    .hero-tabs{
      margin-top:18px;
      display:flex;
      gap:10px;
    }
    .hero-tab{
      flex:1;
      text-align:center;
      padding:6px 0;
      font-size:12px;
      border-radius:999px;
      border:none;
      background:rgba(255,255,255,0.2);
      color:#fff;
      cursor:pointer;
    }
    .hero-tab.active{
      background:#fff;
      color:#3557ff;
      font-weight:600;
    }
    /* day strip */
    .day-strip{
      margin-top:-18px;
      padding:0 12px;
    }
    .day-scroll{
      display:flex;
      overflow-x:auto;
      gap:8px;
      padding-bottom:6px;
    }
    .day-pill{
      min-width:76px;
      padding:6px 8px;
      border-radius:12px;
      background:#e1e7ff;
      text-align:center;
      font-size:11px;
      color:#455;
      cursor:pointer;
      flex-shrink:0;
    }
    .day-pill span{display:block;}
    .day-pill .date{font-weight:600;font-size:12px;}
    .day-pill.active{
      background:#3557ff;
      color:#fff;
    }
    /* content area */
    .content{
      padding:8px 12px 24px;
    }
    .weather-card{
      margin-top:4px;
      background:#fff;
      border-radius:16px;
      padding:12px 12px 10px;
      display:flex;
      align-items:center;
      box-shadow:0 4px 10px rgba(0,0,0,0.04);
      gap:10px;
    }
    .weather-icon{
      width:40px;height:40px;border-radius:50%;
      background:#ecf3ff;
      display:flex;align-items:center;justify-content:center;
      font-size:22px;
    }
    .weather-main{flex:1;}
    .temp-row{font-size:20px;font-weight:700;}
    .temp-low{font-size:12px;margin-left:4px;color:#777;}
    .feel{font-size:11px;color:#777;margin-top:2px;}
    .weather-note{
      font-size:11px;
      color:#555;
      text-align:right;
      min-width:90px;
    }
    .weather-note strong{display:block;font-size:12px;}
    .weather-btn{
      margin-top:4px;
      font-size:10px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid #d1d8ff;
      background:#f5f7ff;
      color:#3557ff;
      cursor:pointer;
    }
    /* timeline cards */
    .section-title{
      margin:14px 4px 6px;
      font-size:13px;
      font-weight:600;
      color:#444;
    }
    .card{
      background:#fff;
      border-radius:14px;
      padding:10px 12px;
      margin-bottom:8px;
      display:flex;
      gap:10px;
      box-shadow:0 3px 8px rgba(0,0,0,0.03);
    }
    .card-icon{
      width:28px;
      font-size:18px;
      padding-top:4px;
      text-align:center;
    }
    .card-body{flex:1;}
    .card-tag-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:4px;
    }
    .card-tag{
      font-size:10px;
      padding:2px 7px;
      border-radius:999px;
      background:#f1f3ff;
      color:#4a57c8;
    }
    .card-time{
      font-size:11px;
      color:#888;
    }
    .card-title{
      font-size:13px;
      font-weight:600;
      margin-bottom:2px;
    }
    .card-desc{
      font-size:12px;
      color:#555;
      word-break:break-all;
    }
    .card-desc a{color:#3557ff;text-decoration:none;}
    .card-desc a:hover{text-decoration:underline;}
    .small-note{
      font-size:11px;
      color:#777;
      margin-top:6px;
    }
    /* expenses & flights */
    .table{
      width:100%;
      border-collapse:collapse;
      font-size:12px;
      background:#fff;
      border-radius:14px;
      overflow:hidden;
      box-shadow:0 3px 8px rgba(0,0,0,0.03);
    }
    .table th,
    .table td{
      padding:6px 6px;
      border-bottom:1px solid #eef1fb;
    }
    .table th{
      background:#f5f7ff;
      font-weight:600;
    }
    .table input{
      width:100%;
      border-radius:6px;
      border:1px solid #dde3f0;
      padding:3px 4px;
      font-size:11px;
    }
    .table-actions{
      margin-top:8px;
      display:flex;
      gap:8px;
      justify-content:flex-end;
    }
    .btn-pill{
      font-size:11px;
      padding:5px 10px;
      border-radius:999px;
      border:none;
      cursor:pointer;
    }
    .btn-secondary{
      background:#fff;
      border:1px solid #d1d8ff;
      color:#3557ff;
    }
    .btn-primary{
      background:#ff7c9b;
      color:#fff;
      border:none;
    }
    .del-btn{
      font-size:11px;
      padding:2px 6px;
      border-radius:999px;
      border:1px solid #f2b2bd;
      background:#fff1f3;
      color:#e06276;
      cursor:pointer;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="hero">
      <div class="hero-inner">
        <div style="display:flex;justify-content:space-between;gap:8px;">
          <div>
            <div class="hero-title">2025 Christmas SEOUL trip ğŸ„</div>
            <div class="hero-dates">2025.12.25 â€“ 12.29</div>
          </div>
          <div class="hero-dest">
            <div>ç›®çš„åœ°</div>
            <strong>Seoul</strong>
          </div>
        </div>
        <div class="hero-tabs">
          <button class="hero-tab active" id="tab-itinerary">ğŸ—º è¡Œç¨‹</button>
          <button class="hero-tab" id="tab-expense">ğŸ’° æ¶ˆè²»</button>
          <button class="hero-tab" id="tab-flight">âœˆï¸ èˆªç­</button>
        </div>
      </div>
    </header>

    <div class="day-strip" id="dayStrip"></div>

    <main class="content">
      <section id="panel-itinerary"></section>
      <section id="panel-expense" style="display:none;"></section>
      <section id="panel-flight" style="display:none;"></section>
    </main>
  </div>

  <script>
    // âœ… å·²ç¶“å…§ç½®ä½ å˜… OpenWeather API key
    const API_KEY = "cc2dab2806da14aec6dab2ed8260a1c4";
    const STORAGE_KEY = "seoul_trip_pro_v2";

    const baseTrip = {
      days: [
        {
          id: "d1",
          labelShort: "12/25",
          weekday: "å››",
          title: "Day 1ï½œå®‰åœ‹ â†’ å¼˜å¤§ â†’ å»¶å—æ´ â†’ æ˜æ´ç‡ˆé£¾",
          city: "Seoul",
          weather: { temp: "", low: "", feel: "", text: "", note: "ç•¶æ—¥æ­¥è¡Œï¼å¤§çœ¾é‹è¼¸" },
          blocks: [
            { icon: "ğŸ½", tag: "æ—©é¤", time: "æ—©ä¸Š", title: "Dotori Garden", desc: "https://naver.me/xzXNBJYr" },
            { icon: "ğŸ›", tag: "å®‰åœ‹æ½®åº—", time: "ä¸Šåˆ", title: "å®‰åœ‹æ½®åº—èµ°èµ°ï¼ˆé †è·¯è¡Œï¼‰",
              desc:
                "ZERO SPACEã€€https://naver.me/5PyocQV5\n" +
                "Objectã€€https://naver.me/xNOAPAtl\n" +
                "Sowol Departmentã€€https://naver.me/ID30Q57R\n" +
                "INOUR MANSIONã€€https://naver.me/x1iTiBKb\n" +
                "OINUã€€https://naver.me/5FcjJ4qz\n" +
                "Tamburins å®‰åœ‹ã€€https://naver.me/5kxLYuXe"
            },
            { icon: "ğŸš‡", tag: "ç§»å‹•", time: "ä¸­åˆå‰", title: "å®‰åœ‹ â†’ å¼˜å¤§å…¥å£", desc: "æ­åœ°éµç§»å‹•" },
            { icon: "ğŸ½", tag: "åˆé¤", time: "ä¸­åˆ", title: "Gop Mapo çƒ¤è‚¥è…¸", desc: "https://naver.me/GPcC4YWc" },
            { icon: "â˜•ï¸", tag: "ä¸‹åˆèŒ¶", time: "ä¸‹åˆ", title: "ARTIST BAKERYï¼ˆå¼˜å¤§ï¼‰", desc: "https://naver.me/FiT5e8AY" },
            { icon: "ğŸš¶â€â™€ï¸", tag: "æ•£æ­¥", time: "ä¸‹åˆ", title: "æ­¥è¡Œ 12 åˆ†é˜ â†’ å»¶å—æ´", desc: "æ…¢è¡Œå»å»¶å—æ´" },
            { icon: "ğŸ§", tag: "å»¶å—æ´", time: "ä¸‹åˆ", title: "å°é£Ÿ & å’–å•¡",
              desc:
                "HUNHUN ç³–é¤…ã€€https://naver.me/5nre0cZm\n" +
                "HIPPO Coffeeï¼ˆç¶­ä¹Ÿç´å’–å•¡ï¼‰ã€€https://naver.me/5MN2vtf4"
            },
            { icon: "ğŸš‡", tag: "ç§»å‹•", time: "å‚æ™š", title: "å»¶å—æ´ â†’ ä¹™æ”¯è·¯å…¥å£ / æ˜æ´æ–¹å‘", desc: "" },
            { icon: "ğŸ½", tag: "æ™šé¤", time: "æ™šé¤", title: "çƒé”é‡Œå®¶ï¼ˆé†¬èŸ¹ï¼‰", desc: "https://naver.me/5jcqjhgG" },
            { icon: "ğŸ„", tag: "å¤œæ™¯", time: "æ™šä¸Š", title: "æ˜æ´è–èª•ç‡ˆé£¾",
              desc: "æ˜æ´è–å ‚ & æ˜æ´å¤§è¡—ã€€https://naver.me/G8EN4VnZ"
            }
          ]
        },
        {
          id: "d2",
          labelShort: "12/26",
          weekday: "äº”",
          title: "Day 2ï½œæ˜æ´ â†’ å—å¤§é–€ â†’ æ±å¤§é–€ â†’ æ–°å ‚è¾£é›çˆª",
          city: "Seoul",
          weather: { temp: "", low: "", feel: "", text: "", note: "è³¼ç‰©æ—¥ï¼Œæ­¥è¡Œè¼ƒå¤š" },
          blocks: [
            { icon: "ğŸ½", tag: "æ—©é¤", time: "æ—©ä¸Š", title: "å®‹å®¶é£¯æ²ï¼ˆæ˜æ´ï¼‰", desc: "https://naver.me/G8uH9PKk" },
            { icon: "ğŸ›", tag: "è³¼ç‰©", time: "ä¸Šåˆ", title: "æ˜æ´è³¼ç‰©", desc: "https://naver.me/5LYTVJQS" },
            { icon: "ğŸ½", tag: "åˆé¤", time: "ä¸­åˆ", title: "éŸ“ç‰›ä¸€æ¢è¡—ï¼ˆé€€æºªè·¯ï¼‰", desc: "https://naver.me/5mOIQw2x" },
            { icon: "ğŸ›", tag: "å¸‚å ´", time: "ä¸‹åˆ", title: "å—å¤§é–€å¸‚å ´", desc: "https://naver.me/Fu2fLt3r" },
            { icon: "ğŸ›", tag: "Shopping", time: "å‚æ™šå‰",
              title: "Doota Mall + No Brand", desc: "https://naver.me/5ooSPrMO" },
            { icon: "ğŸ¨", tag: "ç”œå“", time: "å‚æ™š",
              title: "Scooper Gelatoï¼ˆé–‹å¿ƒæœ AFFOGATOï¼‰", desc: "https://naver.me/GW1qN7HP" },
            { icon: "ğŸ”¥", tag: "æ™šé¤", time: "æ™šä¸Š",
              title: "å‹èª¼è¾£é›çˆªï¼ˆæ–°å ‚ï¼‰", desc: "https://naver.me/ISbHWWes" }
          ]
        },
        {
          id:"d3",
          labelShort:"12/27",
          weekday:"å…­",
          title:"Day 3ï½œå®‰åœ‹ CafÃ© â†’ ç›Šå–„æ´ â†’ ä¹™æ”¯è·¯",
          city:"Seoul",
          weather:{temp:"",low:"",feel:"",text:"",note:"CafÃ© & å°åº—æ…¢éŠ"},
          blocks:[
            {icon:"ğŸ°",tag:"æ—©é¤",time:"æ—©ä¸Š",title:"Cafe Layeredï¼ˆå®‰åœ‹ï¼‰",desc:"https://naver.me/GcBHBVtT"},
            {icon:"ğŸ½",tag:"åˆé¤",time:"ä¸­åˆ",title:"Nakwonjangï¼ˆç›Šå–„æ´ï¼‰",desc:"https://naver.me/F5jtN9zK"},
            {icon:"ğŸ›",tag:"æ•£æ­¥",time:"ä¸‹åˆ",title:"ç›Šå–„æ´æ–‡é’å°åº—æ•£æ­¥",desc:"https://naver.me/5E0PW5pz"},
            {icon:"ğŸ½",tag:"æ™šé¤",time:"æ™šä¸Š",title:"æ°´èŠ¹èœçƒ¤è±¬è‚‰ï¼ˆä¹™æ”¯è·¯ï¼‰",desc:"https://naver.me/5XecCJ2E"},
            {icon:"ğŸŒ™",tag:"è‡ªç”±æ™‚é–“",time:"å¤œæ™š",title:"å›é…’åº— / æ˜æ´æ…¢è¡Œ / ä¾¿åˆ©åº—æƒè²¨",desc:"è‡ªç”±æ´»å‹•"}
          ]
        },
        {
          id:"d4",
          labelShort:"12/28",
          weekday:"æ—¥",
          title:"Day 4ï½œè–æ°´ ALL DAY â†’ æ˜æ´ï¼ˆæ™šé¤ 2é¸1ï¼‰",
          city:"Seoul",
          weather:{temp:"",low:"",feel:"",text:"",note:"è–æ°´ CafÃ© & æ½®åº—"},
          blocks:[
            {icon:"ğŸ",tag:"æ—©é¤",time:"æ—©ä¸Š",title:"Onionï¼ˆè–æ°´ï¼‰",desc:"https://naver.me/FfnQXJR0"},
            {icon:"ğŸ›",tag:"è–æ°´æ½®åº—",time:"ä¸Šåˆ",
              title:"Musinsa / ADER ERROR / Tamburins è–æ°´",
              desc:"Musinsaã€€https://naver.me/FNaQKTjD\nADER ERRORã€€https://naver.me/G7zB8A17\nTamburins è–æ°´ã€€https://naver.me/FSVKkYgr"},
            {icon:"ğŸ½",tag:"åˆé¤",time:"ä¸­åˆ",title:"ç„¡å¢å±‹ï¼ˆè–æ°´ï¼‰",desc:"https://naver.me/IGJfWThB"},
            {icon:"ğŸ®",tag:"ç”œå“",time:"ä¸‹åˆ",title:"Milky Shop",desc:"https://naver.me/FT6ByU3N"},
            {icon:"ğŸš‡",tag:"ç§»å‹•",time:"å‚æ™šå‰",title:"è–æ°´ â†’ æ˜æ´",desc:"åœ°éµç§»å‹•"},
            {icon:"ğŸ²",tag:"æ™šé¤é¸æ“‡",time:"æ™šä¸Š",title:"Option Aï½œIDAEJO æ’éª¨æ¹¯",desc:"https://naver.me/GAyyIQCf"},
            {icon:"ğŸ—",tag:"æ™šé¤é¸æ“‡",time:"æ™šä¸Š",
              title:"Option Bï½œæ˜æ´ç‚¸é›ï¼ˆæ©‹æ‘ / bb.q / NENEï¼‰",
              desc:"æ©‹æ‘ https://naver.me/xGRMiCmh\nbb.q https://naver.me/FPSHzw51\nNENE https://naver.me/5KGh80X0"}
          ]
        },
        {
          id:"d5",
          labelShort:"12/29",
          weekday:"ä¸€",
          title:"Day 5ï½œè£œè²¨ â†’ é°»é­š â†’ æ©Ÿå ´",
          city:"Seoul",
          weather:{temp:"",low:"",feel:"",text:"",note:"å›ç¨‹æ—¥"},
          blocks:[
            {icon:"ğŸ¥ª",tag:"æ—©é¤",time:"æ—©ä¸Š",title:"Egg Dropï¼ˆæ˜æ´ï¼‰",desc:"https://naver.me/5hgOP0Ia"},
            {icon:"ğŸ›",tag:"è³¼ç‰©",time:"ä¸Šåˆ",title:"æ˜æ´æœ€å¾Œæƒè²¨",desc:"https://naver.me/5LYTVJQS"},
            {icon:"ğŸ½",tag:"åˆé¤",time:"ä¸­åˆ",title:"è±å·é°»é­šï¼ˆä¹™æ”¯è·¯ï¼‰",desc:"https://naver.me/5iOaZr9u"},
            {icon:"âœˆï¸",tag:"å›ç¨‹",time:"ä¸‹åˆ",title:"å›é…’åº—æ‹¿è¡Œæ â†’ æ©Ÿå ´",desc:"UO631 ICN â†’ HKG"}
          ]
        }
      ],
      expenses: [],
      flights:[
        {date:"12/25",no:"UO626",route:"HKG â†’ ICN",time:"å¾…ç¢ºèª"},
        {date:"12/29",no:"UO631",route:"ICN â†’ HKG",time:"å¾…ç¢ºèª"}
      ]
    };

    let trip = JSON.parse(localStorage.getItem(STORAGE_KEY) || "null") || baseTrip;

    function saveAll(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(trip));
    }

    // ---- DOM ----
    const dayStrip = document.getElementById('dayStrip');
    const itineraryPanel = document.getElementById('panel-itinerary');
    const expensePanel = document.getElementById('panel-expense');
    const flightPanel = document.getElementById('panel-flight');

    const tabIt = document.getElementById('tab-itinerary');
    const tabEx = document.getElementById('tab-expense');
    const tabFl = document.getElementById('tab-flight');

    let currentDayIndex = 0;

    function renderDayPills(){
      const wrap = document.createElement('div');
      wrap.className = 'day-scroll';
      trip.days.forEach((d,i)=>{
        const pill = document.createElement('div');
        pill.className = 'day-pill'+(i===currentDayIndex?' active':'');
        pill.dataset.index = i;
        pill.innerHTML = `<span class="date">${d.labelShort}</span><span>${d.weekday}</span>`;
        pill.addEventListener('click',()=>{
          currentDayIndex = i;
          document.querySelectorAll('.day-pill').forEach(p=>p.classList.remove('active'));
          pill.classList.add('active');
          renderItinerary();
        });
        wrap.appendChild(pill);
      });
      dayStrip.innerHTML = '';
      dayStrip.appendChild(wrap);
    }

    function linkify(text){
      if(!text) return '';
      const escaped = text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
      return escaped.replace(/(https?:\/\/\S+)/g,'<a href="$1" target="_blank">$1</a>').replace(/\n/g,'<br>');
    }

    async function fetchWeatherForDay(index){
      if(!API_KEY){
        alert("API key ä¸å­˜åœ¨ ğŸ™");
        return;
      }
      const d = trip.days[index];
      const cityQuery = (d.city || "Seoul") + ",KR";
      try{
        const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(cityQuery)}&units=metric&lang=zh_tw&appid=${API_KEY}`;
        const res = await fetch(url);
        if(!res.ok) throw new Error("HTTP "+res.status);
        const data = await res.json();
        d.weather.temp = Math.round(data.main.temp).toString();
        d.weather.low  = Math.round(data.main.temp_min).toString();
        d.weather.feel = Math.round(data.main.feels_like).toString();
        d.weather.text = (data.weather && data.weather[0] && data.weather[0].description) || "";
        saveAll();
      }catch(e){
        console.error(e);
      }
    }

    async function updateAllWeather(){
      try{
        await Promise.all(trip.days.map((_,i)=>fetchWeatherForDay(i)));
      }catch(e){
        console.error(e);
      }finally{
        renderItinerary();
      }
    }

    function renderItinerary(){
      const d = trip.days[currentDayIndex];
      const w = d.weather;
      itineraryPanel.innerHTML = '';

      const weather = document.createElement('div');
      weather.className = 'weather-card';
      weather.innerHTML = `
        <div class="weather-icon">â„ï¸</div>
        <div class="weather-main">
          <div style="font-size:11px;color:#777;margin-bottom:2px;">${d.title}</div>
          <div class="temp-row">${w.temp ? w.temp+"Â°C" : "--"} 
            <span class="temp-low">${w.low ? "/ "+w.low+"Â°C" : ""}</span>
          </div>
          <div class="feel">
            ${w.feel ? "é«”æ„Ÿ "+w.feel+"Â°C ãƒ» " : ""}${w.text || "é¦–æ¬¡é–‹å•Ÿæœƒè‡ªå‹•æ›´æ–°é¦–çˆ¾å¤©æ°£ï¼Œå¦‚è¦å†æ›´æ–°å¯ä»¥æŒ‰ä¸‹é¢æŒ‰éˆ•ã€‚"}
          </div>
          <button class="weather-btn" id="btnWeather">â†» æ›´æ–°é¦–çˆ¾å³æ™‚å¤©æ°£ï¼ˆæ­¤æ—¥ï¼‰</button>
        </div>
        <div class="weather-note">
          <strong>ä»Šæ—¥é‡é»</strong>
          <span>${w.note || ""}</span>
        </div>
      `;
      itineraryPanel.appendChild(weather);

      const secTitle = document.createElement('div');
      secTitle.className = 'section-title';
      secTitle.textContent = 'è¡Œç¨‹å®‰æ’';
      itineraryPanel.appendChild(secTitle);

      d.blocks.forEach(b=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="card-icon">${b.icon}</div>
          <div class="card-body">
            <div class="card-tag-row">
              <span class="card-tag">${b.tag}</span>
              <span class="card-time">${b.time}</span>
            </div>
            <div class="card-title">${b.title}</div>
            <div class="card-desc">${linkify(b.desc || "")}</div>
          </div>
        `;
        itineraryPanel.appendChild(card);
      });

      const note = document.createElement('div');
      note.className = 'small-note';
      note.textContent = 'æç¤ºï¼šä¸Šé¢æ‰€æœ‰ link éƒ½ä¿‚ Naver Mapï¼Œå–ºæ‰‹æ©Ÿæ‰“é–‹æœƒè‡ªå‹•è·³å» Naverã€‚';
      itineraryPanel.appendChild(note);

      const btn = document.getElementById('btnWeather');
      if(btn){
        btn.addEventListener('click', async ()=>{
          await fetchWeatherForDay(currentDayIndex);
          renderItinerary();
          alert("å·²æ›´æ–°ç•¶æ—¥å¤©æ°£ âœ…");
        });
      }
    }

    function renderFlights(){
      flightPanel.innerHTML = '';
      const title = document.createElement('div');
      title.className = 'section-title';
      title.textContent = 'èˆªç­è³‡æ–™ï¼ˆå¯ç·¨è¼¯ï¼‰';
      flightPanel.appendChild(title);

      const table = document.createElement('table');
      table.className = 'table';
      table.innerHTML = `
        <thead>
          <tr>
            <th style="width:20%;">æ—¥æœŸ</th>
            <th style="width:26%;">èˆªç­</th>
            <th style="width:32%;">èˆªç·š</th>
            <th style="width:14%;">æ™‚é–“</th>
            <th style="width:8%;">âœ•</th>
          </tr>
        </thead>
        <tbody></tbody>
      `;
      const tbody = table.querySelector('tbody');

      trip.flights.forEach((f,idx)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input value="${f.date||""}"></td>
          <td><input value="${f.no||""}"></td>
          <td><input value="${f.route||""}"></td>
          <td><input value="${f.time||""}"></td>
          <td style="text-align:center;"><button class="del-btn" data-i="${idx}">åˆª</button></td>
        `;
        tbody.appendChild(tr);
      });

      flightPanel.appendChild(table);

      const actions = document.createElement('div');
      actions.className = 'table-actions';
      actions.innerHTML = `
        <button class="btn-pill btn-secondary" id="btnAddFlight">ï¼‹ æ–°å¢èˆªç­</button>
        <button class="btn-pill btn-primary" id="btnSaveFlight">å„²å­˜èˆªç­</button>
      `;
      flightPanel.appendChild(actions);

      actions.querySelector('#btnAddFlight').addEventListener('click', ()=>{
        trip.flights.push({date:"",no:"",route:"",time:""});
        renderFlights();
      });

      tbody.addEventListener('click', (e)=>{
        if(e.target.classList.contains('del-btn')){
          const i = Number(e.target.dataset.i);
          trip.flights.splice(i,1);
          renderFlights();
        }
      });

      actions.querySelector('#btnSaveFlight').addEventListener('click', ()=>{
        const rows = tbody.querySelectorAll('tr');
        const list = [];
        rows.forEach(r=>{
          const [d,no,route,time] = r.querySelectorAll('input');
          if(d.value || no.value || route.value || time.value){
            list.push({date:d.value,no:no.value,route:route.value,time:time.value});
          }
        });
        trip.flights = list;
        saveAll();
        alert("èˆªç­è³‡æ–™å·²å„²å­˜ âœ…");
      });
    }

    function renderExpenses(){
      expensePanel.innerHTML = '';
      const title = document.createElement('div');
      title.className = 'section-title';
      title.textContent = 'æ¶ˆè²»ç´€éŒ„ï¼ˆå¯ç·¨è¼¯ï¼‰';
      expensePanel.appendChild(title);

      const table = document.createElement('table');
      table.className = 'table';
      table.innerHTML = `
        <thead>
          <tr>
            <th style="width:18%;">æ—¥æœŸ/Day</th>
            <th style="width:26%;">é¡åˆ¥</th>
            <th style="width:26%;">é …ç›®</th>
            <th style="width:16%;">é‡‘é¡</th>
            <th style="width:8%;">âœ•</th>
          </tr>
        </thead>
        <tbody></tbody>
      `;
      const tbody = table.querySelector('tbody');

      trip.expenses.forEach((e,idx)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input value="${e.date||""}"></td>
          <td><input value="${e.cat||""}" placeholder="é¤é£²/äº¤é€šâ€¦"></td>
          <td><input value="${e.item||""}" placeholder="åº—å/å‚™è¨»"></td>
          <td><input value="${e.amount||""}" placeholder="KRW"></td>
          <td style="text-align:center;"><button class="del-btn" data-i="${idx}">åˆª</button></td>
        `;
        tbody.appendChild(tr);
      });

      expensePanel.appendChild(table);

      const actions = document.createElement('div');
      actions.className = 'table-actions';
      actions.innerHTML = `
        <button class="btn-pill btn-secondary" id="btnAddExpense">ï¼‹ æ–°å¢ä¸€ç­†</button>
        <button class="btn-pill btn-primary" id="btnSaveExpense">å„²å­˜æ¶ˆè²»</button>
      `;
      expensePanel.appendChild(actions);

      actions.querySelector('#btnAddExpense').addEventListener('click', ()=>{
        trip.expenses.push({date:"",cat:"",item:"",amount:""});
        renderExpenses();
      });

      tbody.addEventListener('click', e=>{
        if(e.target.classList.contains('del-btn')){
          const i = Number(e.target.dataset.i);
          trip.expenses.splice(i,1);
          renderExpenses();
        }
      });

      actions.querySelector('#btnSaveExpense').addEventListener('click', ()=>{
        const rows = tbody.querySelectorAll('tr');
        const list = [];
        rows.forEach(r=>{
          const [d,cat,item,amt] = r.querySelectorAll('input');
          if(d.value || cat.value || item.value || amt.value){
            list.push({date:d.value,cat:cat.value,item:item.value,amount:amt.value});
          }
        });
        trip.expenses = list;
        saveAll();
        alert("æ¶ˆè²»ç´€éŒ„å·²å„²å­˜ âœ…");
      });
    }

    function switchTab(tab){
      [tabIt,tabEx,tabFl].forEach(b=>b.classList.remove('active'));
      tab.classList.add('active');
      panelSwitch();
    }

    function panelSwitch(){
      const id = document.querySelector('.hero-tab.active').id;
      itineraryPanel.style.display = id==='tab-itinerary' ? 'block':'none';
      expensePanel.style.display   = id==='tab-expense'   ? 'block':'none';
      flightPanel.style.display    = id==='tab-flight'    ? 'block':'none';
    }

    tabIt.addEventListener('click',()=>switchTab(tabIt));
    tabEx.addEventListener('click',()=>switchTab(tabEx));
    tabFl.addEventListener('click',()=>switchTab(tabFl));

    async function init(){
      renderDayPills();
      renderItinerary();
      renderExpenses();
      renderFlights();
      panelSwitch();
      // âœ… é–‹ app æ™‚è‡ªå‹•æ›´æ–°æ‰€æœ‰æ—¥å­å¤©æ°£ï¼ˆä½ æ€çš„ Aï¼‰
      await updateAllWeather();
      alert("å·²è‡ªå‹•æ›´æ–° 5 æ—¥é¦–çˆ¾å¤©æ°£ âœ…");
    }
    init();
  </script>
</body>
</html>
