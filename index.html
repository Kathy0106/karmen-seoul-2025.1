<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Trip Planner</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin:0; padding:0; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; }
    body { background:#f4f7fb; color:#333; }

    .app {
      max-width: 960px;
      margin: 16px auto 40px;
      padding: 12px;
    }

    /* å°é¢ */
    .cover {
      position: relative;
      border-radius: 18px;
      overflow: hidden;
      padding: 16px;
      color: #fff;
      min-height: 160px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      background-size: cover;
      background-position:center;
      background-image: linear-gradient(135deg,#79c5ff,#5d7cff);
    }

    .cover-overlay {
      position:absolute;
      inset:0;
      background:rgba(0,0,0,0.25);
    }

    .cover-content {
      position:relative;
      z-index:1;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
    }

    .cover-title {
      font-size:22px;
      font-weight:700;
      line-height:1.3;
    }

    .cover-sub {
      font-size:14px;
      opacity:0.9;
      margin-top:4px;
    }

    .cover-edit {
      position:relative;
      z-index:1;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
      font-size:12px;
    }

    input[type="text"], input[type="number"], input[type="date"], textarea, select {
      width:100%;
      padding:6px 8px;
      border-radius:8px;
      border:1px solid #dde3f0;
      font-size:13px;
      background:#fff;
    }

    textarea { min-height:110px; resize:vertical; }

    label { font-size:12px; color:#555; display:block; margin-bottom:3px; }

    .input-group { margin-bottom:10px; }

    .btn {
      border:none;
      border-radius:999px;
      padding:8px 16px;
      font-size:13px;
      cursor:pointer;
      background:#ffb74d;
      color:#fff;
      font-weight:600;
      box-shadow:0 3px 6px rgba(0,0,0,0.12);
    }

    .btn-secondary {
      background:#fff;
      color:#555;
      box-shadow:none;
      border:1px solid #dde3f0;
    }

    /* Tabs */
    .tabs {
      display:flex;
      margin-top:18px;
      gap:8px;
    }
    .tab-btn {
      flex:1;
      text-align:center;
      padding:8px 6px;
      border-radius:999px;
      border:none;
      background:#e2e7f5;
      color:#555;
      font-size:13px;
      cursor:pointer;
    }
    .tab-btn.active {
      background:#3f51b5;
      color:#fff;
      font-weight:600;
    }

    .tab {
      margin-top:16px;
      background:#fff;
      border-radius:16px;
      padding:14px;
      box-shadow:0 4px 8px rgba(0,0,0,0.04);
    }

    /* è¡Œç¨‹ Tab */
    .day-selector {
      display:flex;
      align-items:center;
      gap:8px;
      margin-bottom:12px;
      flex-wrap:wrap;
    }
    .pill {
      padding:4px 10px;
      border-radius:999px;
      background:#edf0fb;
      font-size:12px;
    }

    .weather-row {
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-bottom:12px;
    }
    .weather-col {
      flex:1 1 90px;
    }

    .two-col {
      display:flex;
      flex-wrap:wrap;
      gap:12px;
    }
    .two-col > div { flex:1 1 220px; }

    /* Table style */
    table {
      width:100%;
      border-collapse:collapse;
      font-size:13px;
    }
    th, td {
      border-bottom:1px solid #eef1fb;
      padding:6px 4px;
      text-align:left;
    }
    th { background:#f5f7ff; font-weight:600; }
    td input, td select {
      width:100%;
      border-radius:6px;
      border:1px solid #dde3f0;
      padding:4px 6px;
      font-size:12px;
    }
    .table-actions {
      margin-top:8px;
      display:flex;
      gap:8px;
      justify-content:flex-end;
    }

    @media (max-width:600px) {
      .cover { padding:12px; }
      .cover-title { font-size:18px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- å°é¢ -->
    <div id="cover" class="cover">
      <div class="cover-overlay"></div>
      <div class="cover-content">
        <div>
          <div class="cover-title" id="titleDisplay">Hokkaido 2026 Family Trip</div>
          <div class="cover-sub" id="dateDisplay">2026-03-06 ~ 2026-03-10</div>
        </div>
        <div>
          <div style="font-size:12px; text-align:right;">ç›®çš„åœ°</div>
          <div style="font-size:18px;font-weight:600;" id="destinationDisplay">Hokkaido</div>
        </div>
      </div>

      <div class="cover-edit">
        <div style="flex:1 1 140px; min-width:0;">
          <label>è¡Œç¨‹æ¨™é¡Œ</label>
          <input id="titleInput" type="text" placeholder="ä¾‹å¦‚ï¼šHokkaido 2026 Family Trip" />
        </div>
        <div style="flex:1 1 120px; min-width:0;">
          <label>æ—¥æœŸç¯„åœ</label>
          <input id="dateInput" type="text" placeholder="ä¾‹å¦‚ï¼š2026-03-06 ~ 2026-03-10" />
        </div>
        <div style="flex:1 1 100px; min-width:0;">
          <label>ç›®çš„åœ°</label>
          <input id="destinationInput" type="text" placeholder="Hokkaido" />
        </div>
        <div style="flex:1 1 160px; min-width:0;">
          <label>èƒŒæ™¯åœ– URL</label>
          <input id="bgInput" type="text" placeholder="https://...jpg" />
        </div>
        <button class="btn" id="saveMetaBtn">å„²å­˜å°é¢</button>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="plan">ğŸ—“ è¡Œç¨‹</button>
      <button class="tab-btn" data-tab="expenses">ğŸ’° æ¶ˆè²»ç´€éŒ„</button>
      <button class="tab-btn" data-tab="flights">âœˆï¸ èˆªç­è³‡æ–™</button>
    </div>

    <!-- è¡Œç¨‹ Tab -->
    <section class="tab" id="tab-plan">
      <div class="day-selector">
        <span class="pill">Day</span>
        <select id="daySelect">
          <option value="day1">Day 1</option>
          <option value="day2">Day 2</option>
          <option value="day3">Day 3</option>
          <option value="day4">Day 4</option>
          <option value="day5">Day 5</option>
        </select>
        <input id="dayLabelInput" type="text" placeholder="ä¾‹å¦‚ï¼š3/6ï¼ˆäº”ï¼‰æœ­å¹Œ" style="flex:1 1 160px;min-width:0;">
      </div>

      <div class="weather-row">
        <div class="weather-col">
          <label>æ°£æº« (Â°C)</label>
          <input id="tempInput" type="number" placeholder="0">
        </div>
        <div class="weather-col">
          <label>æœ€ä½ (Â°C)</label>
          <input id="lowInput" type="number" placeholder="-5">
        </div>
        <div class="weather-col">
          <label>é«”æ„Ÿ (Â°C)</label>
          <input id="feelInput" type="number" placeholder="-8">
        </div>
        <div class="weather-col">
          <label>å¤©æ°£æè¿°</label>
          <input id="weatherTextInput" type="text" placeholder="å¤§é›ªï¼é™é›ª">
        </div>
      </div>

      <div class="input-group">
        <label>ç•¶æ—¥è¡Œç¨‹ï¼ˆæ™‚é–“ï¼æ™¯é»ï¼å‚™è¨»ï¼‰</label>
        <textarea id="scheduleInput" placeholder="ä¾‹å¦‚ï¼š&#10;06:00 æ¡ƒåœ’æ©Ÿå ´å ±åˆ°&#10;08:35 CI0130 èµ·é£›&#10;..."></textarea>
      </div>

      <button class="btn" id="saveDayBtn">å„²å­˜ç•¶æ—¥è³‡æ–™</button>
      <p style="font-size:11px;color:#777;margin-top:6px;">ï¼ˆè³‡æ–™è‡ªå‹•å­˜æ–¼æ­¤ç€è¦½å™¨ï¼Œä¹‹å¾Œå†é–‹éƒ½ä»²å–ºåº¦ï¼‰</p>
    </section>

    <!-- æ¶ˆè²» Tab -->
    <section class="tab" id="tab-expenses" style="display:none;">
      <table id="expenseTable">
        <thead>
          <tr>
            <th style="width:28%;">æ—¥æœŸï¼Day</th>
            <th style="width:30%;">é …ç›®</th>
            <th style="width:16%;">é‡‘é¡</th>
            <th style="width:14%;">è²¨å¹£</th>
            <th style="width:12%;">åˆªé™¤</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="table-actions">
        <button class="btn-secondary" id="addExpenseRowBtn">ï¼‹ æ–°å¢ä¸€ç­†</button>
        <button class="btn" id="saveExpensesBtn">å„²å­˜æ¶ˆè²»ç´€éŒ„</button>
      </div>
    </section>

    <!-- èˆªç­ Tab -->
    <section class="tab" id="tab-flights" style="display:none;">
      <table id="flightTable">
        <thead>
          <tr>
            <th style="width:22%;">æ—¥æœŸ</th>
            <th style="width:26%;">èˆªç­ç·¨è™Ÿ</th>
            <th style="width:22%;">èµ·é£›</th>
            <th style="width:22%;">æŠµé”</th>
            <th style="width:8%;">âœ•</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="table-actions">
        <button class="btn-secondary" id="addFlightRowBtn">ï¼‹ æ–°å¢èˆªç­</button>
        <button class="btn" id="saveFlightsBtn">å„²å­˜èˆªç­è³‡æ–™</button>
      </div>
    </section>
  </div>

  <script>
    // ----- Data handling -----
    const defaultData = {
      meta: {
        title: "Hokkaido 2026 Family Trip",
        dateRange: "2026-03-06 ~ 2026-03-10",
        destination: "Hokkaido",
        bgUrl: ""
      },
      days: {},          // day1 / day2 / ...
      expenses: [],      // {date,item,amount,currency}
      flights: []        // {date,no,dep,arr}
    };

    let tripData = JSON.parse(localStorage.getItem("tripPlannerData") || "null") || defaultData;

    function saveAll() {
      localStorage.setItem("tripPlannerData", JSON.stringify(tripData));
    }

    // ----- Meta / Cover -----
    const coverEl = document.getElementById("cover");
    const titleDisplay = document.getElementById("titleDisplay");
    const dateDisplay = document.getElementById("dateDisplay");
    const destinationDisplay = document.getElementById("destinationDisplay");
    const titleInput = document.getElementById("titleInput");
    const dateInput = document.getElementById("dateInput");
    const destinationInput = document.getElementById("destinationInput");
    const bgInput = document.getElementById("bgInput");

    function renderMeta() {
      const m = tripData.meta;
      titleDisplay.textContent = m.title;
      dateDisplay.textContent = m.dateRange;
      destinationDisplay.textContent = m.destination;
      titleInput.value = m.title;
      dateInput.value = m.dateRange;
      destinationInput.value = m.destination;
      bgInput.value = m.bgUrl || "";
      if (m.bgUrl) {
        coverEl.style.backgroundImage = `url(${m.bgUrl})`;
      } else {
        coverEl.style.backgroundImage = "linear-gradient(135deg,#79c5ff,#5d7cff)";
      }
    }

    document.getElementById("saveMetaBtn").addEventListener("click", () => {
      tripData.meta.title = titleInput.value || defaultData.meta.title;
      tripData.meta.dateRange = dateInput.value || "";
      tripData.meta.destination = destinationInput.value || "";
      tripData.meta.bgUrl = bgInput.value || "";
      renderMeta();
      saveAll();
      alert("å°é¢å·²å„²å­˜ âœ…");
    });

    // ----- Tabs -----
    const tabBtns = document.querySelectorAll(".tab-btn");
    tabBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        tabBtns.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        const target = btn.dataset.tab;
        document.querySelectorAll(".tab").forEach(tab => {
          tab.style.display = tab.id === "tab-" + target ? "block" : "none";
        });
      });
    });

    // ----- Plan / Days -----
    const daySelect = document.getElementById("daySelect");
    const dayLabelInput = document.getElementById("dayLabelInput");
    const tempInput = document.getElementById("tempInput");
    const lowInput = document.getElementById("lowInput");
    const feelInput = document.getElementById("feelInput");
    const weatherTextInput = document.getElementById("weatherTextInput");
    const scheduleInput = document.getElementById("scheduleInput");

    function loadDay(key) {
      const d = tripData.days[key] || {};
      dayLabelInput.value = d.label || "";
      tempInput.value = d.temp ?? "";
      lowInput.value = d.low ?? "";
      feelInput.value = d.feel ?? "";
      weatherTextInput.value = d.weatherText || "";
      scheduleInput.value = d.schedule || "";
    }

    daySelect.addEventListener("change", () => {
      loadDay(daySelect.value);
    });

    document.getElementById("saveDayBtn").addEventListener("click", () => {
      const key = daySelect.value;
      tripData.days[key] = {
        label: dayLabelInput.value,
        temp: tempInput.value,
        low: lowInput.value,
        feel: feelInput.value,
        weatherText: weatherTextInput.value,
        schedule: scheduleInput.value
      };
      saveAll();
      alert("è¡Œç¨‹å·²å„²å­˜ âœ…");
    });

    // ----- Expenses -----
    const expenseTableBody = document.querySelector("#expenseTable tbody");

    function renderExpenses() {
      expenseTableBody.innerHTML = "";
      tripData.expenses.forEach((row, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><input value="${row.date || ""}" /></td>
          <td><input value="${row.item || ""}" /></td>
          <td><input type="number" step="0.01" value="${row.amount || ""}" /></td>
          <td><input value="${row.currency || ""}" /></td>
          <td style="text-align:center;">
            <button data-index="${index}" class="del-exp btn-secondary" style="padding:2px 8px;font-size:11px;">âœ•</button>
          </td>`;
        expenseTableBody.appendChild(tr);
      });
    }

    document.getElementById("addExpenseRowBtn").addEventListener("click", () => {
      tripData.expenses.push({date:"",item:"",amount:"",currency:""});
      renderExpenses();
    });

    expenseTableBody.addEventListener("click", (e) => {
      if (e.target.classList.contains("del-exp")) {
        const i = Number(e.target.dataset.index);
        tripData.expenses.splice(i,1);
        renderExpenses();
      }
    });

    document.getElementById("saveExpensesBtn").addEventListener("click", () => {
      const rows = expenseTableBody.querySelectorAll("tr");
      const newData = [];
      rows.forEach(tr => {
        const [dateEl, itemEl, amountEl, currEl] = tr.querySelectorAll("input");
        if (dateEl.value || itemEl.value || amountEl.value) {
          newData.push({
            date: dateEl.value,
            item: itemEl.value,
            amount: amountEl.value,
            currency: currEl.value || "JPY"
          });
        }
      });
      tripData.expenses = newData;
      saveAll();
      alert("æ¶ˆè²»ç´€éŒ„å·²å„²å­˜ âœ…");
    });

    // ----- Flights -----
    const flightTableBody = document.querySelector("#flightTable tbody");

    function renderFlights() {
      flightTableBody.innerHTML = "";
      tripData.flights.forEach((row, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><input type="text" value="${row.date || ""}" /></td>
          <td><input type="text" value="${row.no || ""}" /></td>
          <td><input type="text" value="${row.dep || ""}" placeholder="TPE 08:35" /></td>
          <td><input type="text" value="${row.arr || ""}" placeholder="CTS 13:00" /></td>
          <td style="text-align:center;">
            <button data-index="${index}" class="del-flight btn-secondary" style="padding:2px 8px;font-size:11px;">âœ•</button>
          </td>`;
        flightTableBody.appendChild(tr);
      });
    }

    document.getElementById("addFlightRowBtn").addEventListener("click", () => {
      tripData.flights.push({date:"",no:"",dep:"",arr:""});
      renderFlights();
    });

    flightTableBody.addEventListener("click", (e) => {
      if (e.target.classList.contains("del-flight")) {
        const i = Number(e.target.dataset.index);
        tripData.flights.splice(i,1);
        renderFlights();
      }
    });

    document.getElementById("saveFlightsBtn").addEventListener("click", () => {
      const rows = flightTableBody.querySelectorAll("tr");
      const newData = [];
      rows.forEach(tr => {
        const [dateEl, noEl, depEl, arrEl] = tr.querySelectorAll("input");
        if (noEl.value || dateEl.value) {
          newData.push({
            date: dateEl.value,
            no: noEl.value,
            dep: depEl.value,
            arr: arrEl.value
          });
        }
      });
      tripData.flights = newData;
      saveAll();
      alert("èˆªç­è³‡æ–™å·²å„²å­˜ âœ…");
    });

    // ----- Init -----
    function init() {
      renderMeta();
      loadDay("day1");
      renderExpenses();
      renderFlights();
    }
    init();
  </script>
</body>
</html>