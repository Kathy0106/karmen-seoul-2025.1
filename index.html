<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>2025 Christmas SEOUL trip ğŸ„</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    * { box-sizing:border-box; margin:0; padding:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; }
    body { background:#f4f7fb; color:#333; }

    .app {
      max-width:960px;
      margin:16px auto 40px;
      padding:12px;
    }

    /* å°é¢ */
    .cover {
      position:relative;
      border-radius:18px;
      overflow:hidden;
      padding:16px;
      color:#fff;
      min-height:180px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      background-size:cover;
      background-position:center;
      background-image:url('cover.jpg'); /* ğŸ‘ˆ æŠŠä½ å¼µç›¸å­˜æˆ cover.jpg */
    }

    .cover-overlay {
      position:absolute;
      inset:0;
      background:linear-gradient(135deg,rgba(0,0,0,0.55),rgba(0,0,0,0.25));
    }

    .cover-content {
      position:relative;
      z-index:1;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
    }

    .cover-title {
      font-size:22px;
      font-weight:700;
      line-height:1.3;
    }

    .cover-sub {
      font-size:14px;
      opacity:0.9;
      margin-top:4px;
    }

    .cover-edit {
      position:relative;
      z-index:1;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
      font-size:12px;
    }

    input[type="text"], input[type="number"], input[type="date"], textarea, select {
      width:100%;
      padding:6px 8px;
      border-radius:8px;
      border:1px solid #dde3f0;
      font-size:13px;
      background:#fff;
    }
    textarea { min-height:110px; resize:vertical; }

    label { font-size:12px; color:#555; display:block; margin-bottom:3px; }
    .input-group { margin-bottom:10px; }

    .btn {
      border:none;
      border-radius:999px;
      padding:8px 16px;
      font-size:13px;
      cursor:pointer;
      background:#ff7c9b;
      color:#fff;
      font-weight:600;
      box-shadow:0 3px 6px rgba(0,0,0,0.12);
    }

    .btn-secondary {
      border:1px solid #dde3f0;
      background:#fff;
      color:#555;
      border-radius:999px;
      padding:7px 14px;
      font-size:12px;
      cursor:pointer;
    }

    .tabs {
      display:flex;
      margin-top:18px;
      gap:8px;
    }
    .tab-btn {
      flex:1;
      text-align:center;
      padding:8px 6px;
      border-radius:999px;
      border:none;
      background:#e2e7f5;
      color:#555;
      font-size:13px;
      cursor:pointer;
    }
    .tab-btn.active {
      background:#3f51b5;
      color:#fff;
      font-weight:600;
    }

    .tab {
      margin-top:16px;
      background:#fff;
      border-radius:16px;
      padding:14px;
      box-shadow:0 4px 8px rgba(0,0,0,0.04);
    }

    .day-selector {
      display:flex;
      align-items:center;
      gap:8px;
      margin-bottom:12px;
      flex-wrap:wrap;
    }
    .pill {
      padding:4px 10px;
      border-radius:999px;
      background:#edf0fb;
      font-size:12px;
    }

    .weather-row {
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-bottom:12px;
    }
    .weather-col { flex:1 1 90px; }

    .two-col { display:flex; flex-wrap:wrap; gap:12px; }
    .two-col > div { flex:1 1 220px; }

    table {
      width:100%;
      border-collapse:collapse;
      font-size:13px;
    }
    th, td {
      border-bottom:1px solid #eef1fb;
      padding:6px 4px;
      text-align:left;
    }
    th { background:#f5f7ff; font-weight:600; }
    td input {
      width:100%;
      border-radius:6px;
      border:1px solid #dde3f0;
      padding:4px 6px;
      font-size:12px;
    }

    .table-actions {
      margin-top:8px;
      display:flex;
      gap:8px;
      justify-content:flex-end;
    }

    @media (max-width:600px) {
      .cover { padding:12px; }
      .cover-title { font-size:18px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- å°é¢ -->
    <div id="cover" class="cover">
      <div class="cover-overlay"></div>
      <div class="cover-content">
        <div>
          <div class="cover-title" id="titleDisplay">2025 Christmas SEOUL trip ğŸ„</div>
          <div class="cover-sub" id="dateDisplay">2025.12.25 â€“ 12.29</div>
        </div>
        <div style="text-align:right;">
          <div style="font-size:12px;">ç›®çš„åœ°</div>
          <div style="font-size:18px;font-weight:600;" id="destinationDisplay">Seoul</div>
        </div>
      </div>

      <div class="cover-edit">
        <div style="flex:1 1 160px;min-width:0;">
          <label>è¡Œç¨‹æ¨™é¡Œ</label>
          <input id="titleInput" type="text" />
        </div>
        <div style="flex:1 1 140px;min-width:0;">
          <label>æ—¥æœŸç¯„åœ</label>
          <input id="dateInput" type="text" />
        </div>
        <div style="flex:1 1 120px;min-width:0;">
          <label>ç›®çš„åœ°</label>
          <input id="destinationInput" type="text" />
        </div>
        <div style="flex:1 1 160px;min-width:0;">
          <label>èƒŒæ™¯åœ–æª”å</label>
          <input id="bgInput" type="text" placeholder="cover.jpg" />
        </div>
        <button class="btn" id="saveMetaBtn">å„²å­˜å°é¢</button>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="plan">ğŸ—“ è¡Œç¨‹</button>
      <button class="tab-btn" data-tab="expenses">ğŸ’° æ¶ˆè²»ç´€éŒ„</button>
      <button class="tab-btn" data-tab="flights">âœˆï¸ èˆªç­è³‡æ–™</button>
    </div>

    <!-- è¡Œç¨‹ Tab -->
    <section class="tab" id="tab-plan">
      <div class="day-selector">
        <span class="pill">Day</span>
        <select id="daySelect">
          <option value="day1">Day 1</option>
          <option value="day2">Day 2</option>
          <option value="day3">Day 3</option>
          <option value="day4">Day 4</option>
          <option value="day5">Day 5</option>
        </select>
        <input id="dayLabelInput" type="text" placeholder="ä¾‹å¦‚ï¼š12/25ï¼ˆå››ï¼‰å®‰åœ‹ â†’ å¼˜å¤§ ..." style="flex:1 1 200px;min-width:0;">
      </div>

      <div class="weather-row">
        <div class="weather-col">
          <label>åŸå¸‚ï¼ˆè‡ªå‹•å¤©æ°£ï¼‰</label>
          <input id="cityInput" type="text" placeholder="Seoul">
        </div>
        <div class="weather-col">
          <label>&nbsp;</label>
          <button class="btn-secondary" type="button" id="fetchWeatherBtn">å–å¾—å³æ™‚å¤©æ°£</button>
        </div>
        <div class="weather-col">
          <label>æ°£æº« (Â°C)</label>
          <input id="tempInput" type="number">
        </div>
        <div class="weather-col">
          <label>æœ€ä½ (Â°C)</label>
          <input id="lowInput" type="number">
        </div>
        <div class="weather-col">
          <label>é«”æ„Ÿ (Â°C)</label>
          <input id="feelInput" type="number">
        </div>
        <div class="weather-col">
          <label>å¤©æ°£æè¿°</label>
          <input id="weatherTextInput" type="text" placeholder="æ™´ / å°é›ª ...">
        </div>
      </div>

      <div class="input-group">
        <label>ç•¶æ—¥è¡Œç¨‹</label>
        <textarea id="scheduleInput"></textarea>
      </div>

      <button class="btn" id="saveDayBtn">å„²å­˜ç•¶æ—¥è³‡æ–™</button>
      <p style="font-size:11px;color:#777;margin-top:6px;">ï¼ˆæ‰€æœ‰è³‡æ–™æœƒå­˜å–ºæœ¬æ©Ÿ browser localStorageï¼‰</p>
    </section>

    <!-- æ¶ˆè²» Tabï¼ˆä½ ä¹‹å¾Œè‡ªå·±åŠ éƒ½å¾—ï¼Œé è¨­ç©ºç™½ï¼‰ -->
    <section class="tab" id="tab-expenses" style="display:none;">
      <table id="expenseTable">
        <thead>
          <tr>
            <th style="width:26%;">æ—¥æœŸï¼Day</th>
            <th style="width:32%;">é …ç›®</th>
            <th style="width:18%;">é‡‘é¡</th>
            <th style="width:14%;">è²¨å¹£</th>
            <th style="width:10%;">åˆªé™¤</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="table-actions">
        <button class="btn-secondary" id="addExpenseRowBtn">ï¼‹ æ–°å¢ä¸€ç­†</button>
        <button class="btn" id="saveExpensesBtn">å„²å­˜æ¶ˆè²»ç´€éŒ„</button>
      </div>
    </section>

    <!-- èˆªç­ Tab -->
    <section class="tab" id="tab-flights" style="display:none;">
      <table id="flightTable">
        <thead>
          <tr>
            <th style="width:22%;">æ—¥æœŸ</th>
            <th style="width:26%;">èˆªç­ç·¨è™Ÿ</th>
            <th style="width:24%;">èµ·é£›</th>
            <th style="width:24%;">æŠµé”</th>
            <th style="width:4%;">âœ•</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="table-actions">
        <button class="btn-secondary" id="addFlightRowBtn">ï¼‹ æ–°å¢èˆªç­</button>
        <button class="btn" id="saveFlightsBtn">å„²å­˜èˆªç­è³‡æ–™</button>
      </div>
    </section>
  </div>

  <script>
    // =========================
    //  OpenWeather è¨­å®š
    // =========================
    const API_KEY = "YOUR_API_KEY_HERE"; // ğŸ‘ˆ åœ¨é€™è£¡æ”¾ä½ çš„ OpenWeather API key

    // =========================
    //  åˆå§‹è³‡æ–™ï¼ˆå·²å¡«å¥½äº”æ—¥è¡Œç¨‹ï¼‹èˆªç­ï¼‰
    // =========================
    const defaultData = {
      meta: {
        title: "2025 Christmas SEOUL trip ğŸ„",
        dateRange: "2025.12.25 â€“ 12.29",
        destination: "Seoul",
        bgUrl: "cover.jpg"
      },
      days: {
        day1: {
          label: "Day 1ï½œ12/25ï½œå®‰åœ‹ â†’ å¼˜å¤§ â†’ å»¶å—æ´ â†’ æ˜æ´ç‡ˆé£¾",
          city: "Seoul",
          temp: "",
          low: "",
          feel: "",
          weatherText: "",
          schedule:
"ğŸ½ æ—©é¤ï½œDotori Garden\nhttps://naver.me/xzXNBJYr\n\nğŸ› å®‰åœ‹æ½®åº—èµ°èµ°ï¼ˆé †è·¯è¡Œï¼‰\nZERO SPACEã€€https://naver.me/5PyocQV5\nObjectã€€https://naver.me/xNOAPAtl\nSowol Departmentã€€https://naver.me/ID30Q57R\nINOUR MANSIONã€€https://naver.me/x1iTiBKb\nOINUã€€https://naver.me/5FcjJ4qz\nTamburins å®‰åœ‹åº—ã€€https://naver.me/5kxLYuXe\n\nâ¡ï¸ ğŸš‡ å®‰åœ‹ â†’ å¼˜å¤§å…¥å£\n\nğŸ½ åˆé¤ï½œGop Mapo çƒ¤è‚¥è…¸\nhttps://naver.me/GPcC4YWc\n\nâ˜• ä¸‹åˆèŒ¶ï½œARTIST BAKERYï¼ˆå¼˜å¤§ï¼‰\nhttps://naver.me/FiT5e8AY\n\nâ¡ï¸ å¾’æ­¥ 12 åˆ†é˜ â†’ å»¶å—æ´\n\nğŸ§ å»¶å—æ´æ•£æ­¥ + å°é£Ÿ & å’–å•¡\nHUNHUN ç³–é¤… í›ˆí›ˆí˜¸ë–¡ã€€https://naver.me/5nre0cZm\nHIPPO Coffeeï¼ˆç¶­ä¹Ÿç´å’–å•¡ï¼‰ã€€https://naver.me/5MN2vtf4\n\nâ¡ï¸ ğŸš‡ å»¶å—æ´ â†’ ä¹™æ”¯è·¯å…¥å£ / æ˜æ´æ–¹å‘\n\nğŸ½ æ™šé¤ï½œğŸ¦€ çƒé”é‡Œå®¶ï¼ˆé†¬èŸ¹ï¼‰\nhttps://naver.me/5jcqjhgG\n\nğŸ„ è–èª•ç‡ˆé£¾ï½œæ˜æ´è–å ‚ & æ˜æ´å¤§è¡—\nhttps://naver.me/G8EN4VnZ"
        },
        day2: {
          label: "Day 2ï½œ12/26ï½œæ˜æ´ â†’ å—å¤§é–€ â†’ æ±å¤§é–€ â†’ æ–°å ‚è¾£é›çˆª",
          city: "Seoul",
          temp: "",
          low: "",
          feel: "",
          weatherText: "",
          schedule:
"ğŸ½ æ—©é¤ï½œå®‹å®¶é£¯æ²ï¼ˆæ˜æ´ï¼‰\nhttps://naver.me/G8uH9PKk\n\nğŸ› æ˜æ´è³¼ç‰©\nhttps://naver.me/5LYTVJQS\n\nğŸ½ åˆé¤ï½œéŸ“ç‰›ä¸€æ¢è¡—ï¼ˆé€€æºªè·¯ï¼‰\nhttps://naver.me/5mOIQw2x\n\nğŸ› å—å¤§é–€å¸‚å ´\nhttps://naver.me/Fu2fLt3r\n\nğŸ› Doota Mall + No Brand\nhttps://naver.me/5ooSPrMO\n\nğŸ¨ Scooper Gelatoï¼ˆé–‹å¿ƒæœ AFFOGATOï¼‰\nhttps://naver.me/GW1qN7HP\n\nğŸ½ æ™šé¤ï½œå‹èª¼è¾£é›çˆªï¼ˆæ–°å ‚ï¼‰ğŸ”¥\nhttps://naver.me/ISbHWWes"
        },
        day3: {
          label: "Day 3ï½œ12/27ï½œå®‰åœ‹ CafÃ© â†’ ç›Šå–„æ´ â†’ ä¹™æ”¯è·¯",
          city: "Seoul",
          temp: "",
          low: "",
          feel: "",
          weatherText: "",
          schedule:
"ğŸ½ æ—©é¤ï½œCafe Layeredï¼ˆå®‰åœ‹ï¼‰\nhttps://naver.me/GcBHBVtT\n\nğŸ½ åˆé¤ï½œNakwonjangï¼ˆç›Šå–„æ´ï¼‰\nhttps://naver.me/F5jtN9zK\n\nğŸ› ç›Šå–„æ´æ–‡é’å°åº—æ•£æ­¥\nhttps://naver.me/5E0PW5pz\n\nğŸ½ æ™šé¤ï½œæ°´èŠ¹èœçƒ¤è±¬è‚‰ï¼ˆä¹™æ”¯è·¯ï¼‰\nhttps://naver.me/5XecCJ2E\n\nğŸŒ™ After dinner â†’ è‡ªç”±æ´»å‹•\nå›é…’åº—ä¼‘æ¯ ï¼ æ…¢è¡Œæ˜æ´ ï¼ ä¾¿åˆ©åº—æƒè²¨"
        },
        day4: {
          label: "Day 4ï½œ12/28ï½œè–æ°´ ALL DAY â†’ æ˜æ´ï¼ˆæ™šé¤ 2é¸1ï¼‰",
          city: "Seoul",
          temp: "",
          low: "",
          feel: "",
          weatherText: "",
          schedule:
"ğŸ½ æ—©é¤ï½œOnionï¼ˆè–æ°´ï¼‰\nhttps://naver.me/FfnQJR0\n\nğŸ› è–æ°´æ½®åº—\nMusinsa Flagshipã€€https://naver.me/FNaQKTjD\nADER ERRORã€€https://naver.me/G7zB8A17\nTamburins è–æ°´ã€€https://naver.me/FSVKkYgr\n\nğŸ½ åˆé¤ï½œç„¡å¢å±‹ï¼ˆè–æ°´ï¼‰\nhttps://naver.me/IGJfWThB\n\nğŸ® ç”œå“ï½œMilky Shop\nhttps://naver.me/FT6ByU3N\n\nâ¡ï¸ ğŸš‡ è–æ°´ â†’ æ˜æ´\n\nğŸŒ™ æ™šé¤ç•¶æ—¥è‡ªé¸ï¼š\nğŸŸ¢ Option Aï½œIDAEJO æ’éª¨æ¹¯ï¼ˆì´ëŒ€ì¡° ê°ìíƒ•ï¼‰\nhttps://naver.me/GAyyIQCf\n\nğŸŸ¡ Option Bï½œæ˜æ´ç‚¸é›\næ©‹æ‘ã€€https://naver.me/xGRMiCmh\nbb.qã€€https://naver.me/FPSHzw51\nNENEã€€https://naver.me/5KGh80X0"
        },
        day5: {
          label: "Day 5ï½œ12/29ï½œè£œè²¨ â†’ é°»é­š â†’ æ©Ÿå ´",
          city: "Seoul",
          temp: "",
          low: "",
          feel: "",
          weatherText: "",
          schedule:
"ğŸ½ æ—©é¤ï½œEgg Dropï¼ˆæ˜æ´ï¼‰\nhttps://naver.me/5hgOP0Ia\n\nğŸ› æ˜æ´æœ€å¾Œæƒè²¨\nhttps://naver.me/5LYTVJQS\n\nğŸ½ åˆé¤ï½œğŸ”¥ è±å·é°»é­šï¼ˆä¹™æ”¯è·¯ï¼‰\nhttps://naver.me/5iOaZr9u\n\nâ¡ï¸ æ‹è¡Œæ â†’ æ©Ÿå ´ âœˆï¸"
        }
      },
      expenses: [],
      flights: [
        { date:"2025-12-25", no:"UO626", dep:"HKG â†’ ICN", arr:"" },
        { date:"2025-12-29", no:"UO631", dep:"ICN â†’ HKG", arr:"" }
      ]
    };

    let tripData = JSON.parse(localStorage.getItem("tripPlannerData") || "null") || defaultData;

    function saveAll() {
      localStorage.setItem("tripPlannerData", JSON.stringify(tripData));
    }

    // -------- å°é¢æ¸²æŸ“ --------
    const coverEl = document.getElementById("cover");
    const titleDisplay = document.getElementById("titleDisplay");
    const dateDisplay = document.getElementById("dateDisplay");
    const destinationDisplay = document.getElementById("destinationDisplay");
    const titleInput = document.getElementById("titleInput");
    const dateInput = document.getElementById("dateInput");
    const destinationInput = document.getElementById("destinationInput");
    const bgInput = document.getElementById("bgInput");

    function renderMeta() {
      const m = tripData.meta;
      titleDisplay.textContent = m.title;
      dateDisplay.textContent = m.dateRange;
      destinationDisplay.textContent = m.destination;
      titleInput.value = m.title;
      dateInput.value = m.dateRange;
      destinationInput.value = m.destination;
      bgInput.value = m.bgUrl || "cover.jpg";
      if (m.bgUrl) {
        coverEl.style.backgroundImage = `url('${m.bgUrl}')`;
      }
    }

    document.getElementById("saveMetaBtn").addEventListener("click", () => {
      tripData.meta.title = titleInput.value || defaultData.meta.title;
      tripData.meta.dateRange = dateInput.value || defaultData.meta.dateRange;
      tripData.meta.destination = destinationInput.value || defaultData.meta.destination;
      tripData.meta.bgUrl = bgInput.value || "cover.jpg";
      renderMeta();
      saveAll();
      alert("å°é¢å·²å„²å­˜ âœ…");
    });

    // -------- Tabs --------
    const tabBtns = document.querySelectorAll(".tab-btn");
    tabBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        tabBtns.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        const target = btn.dataset.tab;
        document.querySelectorAll(".tab").forEach(tab => {
          tab.style.display = tab.id === "tab-" + target ? "block" : "none";
        });
      });
    });

    // -------- è¡Œç¨‹ï¼å¤©æ°£ --------
    const daySelect = document.getElementById("daySelect");
    const dayLabelInput = document.getElementById("dayLabelInput");
    const cityInput = document.getElementById("cityInput");
    const tempInput = document.getElementById("tempInput");
    const lowInput = document.getElementById("lowInput");
    const feelInput = document.getElementById("feelInput");
    const weatherTextInput = document.getElementById("weatherTextInput");
    const scheduleInput = document.getElementById("scheduleInput");

    function loadDay(key) {
      const d = tripData.days[key] || {};
      dayLabelInput.value = d.label || "";
      cityInput.value = d.city || tripData.meta.destination || "Seoul";
      tempInput.value = d.temp ?? "";
      lowInput.value = d.low ?? "";
      feelInput.value = d.feel ?? "";
      weatherTextInput.value = d.weatherText || "";
      scheduleInput.value = d.schedule || "";
    }

    daySelect.addEventListener("change", () => {
      loadDay(daySelect.value);
    });

    document.getElementById("saveDayBtn").addEventListener("click", () => {
      const key = daySelect.value;
      tripData.days[key] = {
        label: dayLabelInput.value,
        city: cityInput.value,
        temp: tempInput.value,
        low: lowInput.value,
        feel: feelInput.value,
        weatherText: weatherTextInput.value,
        schedule: scheduleInput.value
      };
      saveAll();
      alert("è¡Œç¨‹å·²å„²å­˜ âœ…");
    });

    // è‡ªå‹•å¤©æ°£
    const fetchWeatherBtn = document.getElementById("fetchWeatherBtn");
    fetchWeatherBtn.addEventListener("click", async () => {
      if (!API_KEY || API_KEY === "YOUR_API_KEY_HERE") {
        alert("è«‹å…ˆåœ¨ç¨‹å¼ç¢¼ä¸­å¡«å…¥ä½ çš„ OpenWeather API key ğŸ™");
        return;
      }
      const city = (cityInput.value || tripData.meta.destination || "Seoul") + ",KR";
      try {
        const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&units=metric&lang=zh_tw&appid=${API_KEY}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        const temp = Math.round(data.main.temp);
        const feels = Math.round(data.main.feels_like);
        const low = Math.round(data.main.temp_min);
        const desc = data.weather && data.weather[0] && data.weather[0].description || "";

        tempInput.value = temp;
        lowInput.value = low;
        feelInput.value = feels;
        weatherTextInput.value = desc;

        alert("å·²æ›´æ–°å³æ™‚å¤©æ°£ âœ…");
      } catch (e) {
        console.error(e);
        alert("å–å¾—å¤©æ°£å¤±æ•—ï¼Œè«‹æª¢æŸ¥åŸå¸‚åç¨±æˆ– API key ğŸ”");
      }
    });

    // -------- æ¶ˆè²» --------
    const expenseTableBody = document.querySelector("#expenseTable tbody");

    function renderExpenses() {
      expenseTableBody.innerHTML = "";
      tripData.expenses.forEach((row, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><input value="${row.date || ""}" /></td>
          <td><input value="${row.item || ""}" /></td>
          <td><input type="number" step="0.01" value="${row.amount || ""}" /></td>
          <td><input value="${row.currency || ""}" /></td>
          <td style="text-align:center;">
            <button data-index="${index}" class="del-exp btn-secondary" style="padding:2px 8px;font-size:11px;">âœ•</button>
          </td>`;
        expenseTableBody.appendChild(tr);
      });
    }

    document.getElementById("addExpenseRowBtn").addEventListener("click", () => {
      tripData.expenses.push({date:"",item:"",amount:"",currency:"KRW"});
      renderExpenses();
    });

    expenseTableBody.addEventListener("click", e => {
      if (e.target.classList.contains("del-exp")) {
        const i = Number(e.target.dataset.index);
        tripData.expenses.splice(i,1);
        renderExpenses();
      }
    });

    document.getElementById("saveExpensesBtn").addEventListener("click", () => {
      const rows = expenseTableBody.querySelectorAll("tr");
      const newData = [];
      rows.forEach(tr => {
        const [dateEl,itemEl,amountEl,currEl] = tr.querySelectorAll("input");
        if (dateEl.value || itemEl.value || amountEl.value) {
          newData.push({
            date: dateEl.value,
            item: itemEl.value,
            amount: amountEl.value,
            currency: currEl.value || "KRW"
          });
        }
      });
      tripData.expenses = newData;
      saveAll();
      alert("æ¶ˆè²»ç´€éŒ„å·²å„²å­˜ âœ…");
    });

    // -------- èˆªç­ --------
    const flightTableBody = document.querySelector("#flightTable tbody");

    function renderFlights() {
      flightTableBody.innerHTML = "";
      tripData.flights.forEach((row,index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><input type="text" value="${row.date || ""}" /></td>
          <td><input type="text" value="${row.no || ""}" /></td>
          <td><input type="text" value="${row.dep || ""}" /></td>
          <td><input type="text" value="${row.arr || ""}" /></td>
          <td style="text-align:center;">
            <button data-index="${index}" class="del-flight btn-secondary" style="padding:2px 8px;font-size:11px;">âœ•</button>
          </td>
        `;
        flightTableBody.appendChild(tr);
      });
    }

    document.getElementById("addFlightRowBtn").addEventListener("click", () => {
      tripData.flights.push({date:"",no:"",dep:"",arr:""});
      renderFlights();
    });

    flightTableBody.addEventListener("click", e => {
      if (e.target.classList.contains("del-flight")) {
        const i = Number(e.target.dataset.index);
        tripData.flights.splice(i,1);
        renderFlights();
      }
    });

    document.getElementById("saveFlightsBtn").addEventListener("click", () => {
      const rows = flightTableBody.querySelectorAll("tr");
      const newData = [];
      rows.forEach(tr => {
        const [dateEl,noEl,depEl,arrEl] = tr.querySelectorAll("input");
        if (dateEl.value || noEl.value) {
          newData.push({
            date: dateEl.value,
            no: noEl.value,
            dep: depEl.value,
            arr: arrEl.value
          });
        }
      });
      tripData.flights = newData;
      saveAll();
      alert("èˆªç­è³‡æ–™å·²å„²å­˜ âœ…");
    });

    // -------- åˆå§‹åŒ– --------
    function init() {
      renderMeta();
      loadDay("day1");
      renderExpenses();
      renderFlights();
    }
    init();
  </script>
</body>
</html>